# ============================================================================
# MTT-SPECIFIC CONFIGURATION (Example Implementation)
# ============================================================================
# 
# ⚠️ WARNING: This configuration is PROJECT-SPECIFIC and will NOT work for other JPD projects!
# 
# This is a REFERENCE EXAMPLE showing how the tool can be configured for a real project.
# 
# Hard-coded MTT-specific values:
# - Field IDs: customfield_14385, customfield_14425 (only exist in MTT project)
# - Status names: Idea, Discovery, Icebox, Epic Design, Backlog, Ready, In Progress, In Review, Done
# - Label mappings: bug→Bug, epic→Epic, story→Story (MTT conventions)
# - Transform functions: MTT-specific field ID references
# 
# For YOUR project: Start with ../../config/sync-config.minimal.yaml
# Documentation: ../../docs/ARCHITECTURE.md and ../../docs/TRANSFORM_PATTERNS.md
# 
# See README.md in this directory for more information about this example.
# ============================================================================

# MTT Test Project - Clean, Essential Configuration
# Focus: Core fields, proper hierarchy, clean labels

sync:
  direction: bidirectional
  jql: 'project = MTT'

# ==========================================
# GITHUB → JPD CREATION (Reverse Sync)
# ==========================================
github_to_jpd_creation:
  enabled: true
  
  # Map GitHub labels to JPD Category field (type of issue)
  # Valid JPD Categories: Bug, Epic, Story (NOT "Idea" - that's a STATUS)
  label_to_category:
    bug: "Bug"
    epic: "Epic"
    story: "Story"
    # Note: "enhancement" label not mapped - falls through to default_category
  
  # Default category for unlabeled issues (or "enhancement" label)
  default_category: "Story"  # Unlabeled or enhancement → Story category
  
  # Initial workflow status for created issues
  default_status: "Idea"  # "Idea" status = initial intake state (not synced back to GitHub)
  
  # Optional default priority
  default_priority: "Medium"
  
  # MTT-specific field IDs for category and priority
  field_mappings:
    category_field_id: "customfield_14385"  # MTT Category field
    priority_field_id: "customfield_14425"  # MTT Dev Priority field

# ==========================================
# FIELD MAPPINGS (Essential Only)
# ==========================================
mappings:
  # Title
  - jpd: "fields.summary"
    github: "title"

  # Rich body with JPD context
  - jpd: "fields.description"
    github: "body"
    transform_function: "../transforms/build-issue-body.ts"

  # Category → Type labels (bug/epic/story/enhancement)
  # Map directly, lowercase, no prefix
  - jpd: "fields.customfield_14385.value"  # Category
    github: "labels"
    template: "{{fields.customfield_14385.value | lowercase}}"

  # Dev Priority → priority labels (critical/high/normal/low)
  - jpd: "."
    github: "labels"
    transform_function: "../transforms/derive-priority.ts"

# ==========================================
# STATUS MAPPINGS (Workflow)
# ==========================================
statuses:
  # Intake/Planning (PM territory, not synced to GitHub yet)
  "Idea":
    sync: false  # Don't sync raw ideas
  
  "Discovery":
    sync: false  # Don't sync during evaluation

  "Icebox":
    sync: false  # Don't sync parked items

  # Ready for Dev (Start syncing here)
  "Epic Design":
    github_state: open
    github_project_status: "Epic Design"
    sync: true

  "Backlog":
    github_state: open
    github_project_status: "Backlog"
    sync: true

  "Ready":
    github_state: open
    github_project_status: "Ready"
    sync: true

  # Active Development
  "In Progress":
    github_state: open
    github_project_status: "In Progress"
    sync: true
    # Note: GitHub → JPD sync disabled for ambiguous open states

  "In Review":
    github_state: open
    github_project_status: "In Review"
    sync: true
    # Note: GitHub → JPD sync disabled for ambiguous open states

  # Complete (Only unambiguous GitHub → JPD mapping)
  "Done":
    github_state: closed
    github_project_status: "Done"
    sync: true
    # GitHub closed → JPD Done (clear mapping)

# ==========================================
# HIERARCHY (Use JPD's Native Parent-Child)
# ==========================================
hierarchy:
  # Use JPD's issuelinks with type "Subtask" for parent-child relationships
  # Epic (parent) → Story (subtask via issuelink)
  # Story (parent) → Task (subtask via issuelink)
  
  use_native_hierarchy: true
  link_type: "Subtask"
  
  # Auto-add hierarchy labels based on Category field
  # Category "Epic" → label: epic
  # Category "Story" → label: story
  # (Already handled in mappings above)

# ==========================================
# GITHUB PROJECTS (Optional)
# ==========================================
# projects:
#   enabled: false
#   project_number: 1  # Your GitHub project number

# ==========================================
# FIELD DEFINITIONS (Validation)
# ==========================================
fields:
  - id: "customfield_14385"
    name: "Category"
    type: "select"
    required: true
    description: "Issue type (Bug/Epic/Story/Enhancement)"

  - id: "customfield_14425"
    name: "Dev Priority"
    type: "select"
    required: false
    description: "Execution priority (Critical/High/Medium/Low)"

# ==========================================
# GITHUB LABELS (Auto-Created)
# ==========================================
# Labels are automatically created when first used
# Run `pnpm run setup-labels` to pre-create all labels
labels:
  # Hierarchy labels (from Category field)
  hierarchy:
    - name: "epic"
      color: "0052CC"
      description: "High-level initiative"
    - name: "story"
      color: "2684FF"
      description: "User story"
    - name: "task"
      color: "B3D4FF"
      description: "Implementation task"
    - name: "bug"
      color: "DE350B"
      description: "Bug fix"
  
  # Priority labels (from Dev Priority field)
  priorities:
    - name: "priority:critical"
      color: "DE350B"
      description: "Critical priority"
    - name: "priority:high"
      color: "FF8B00"
      description: "High priority"
    - name: "priority:normal"
      color: "FFC400"
      description: "Normal priority"
    - name: "priority:low"
      color: "8993A4"
      description: "Low priority"

# ==========================================
# FIELD ID REFERENCE
# ==========================================
field_ids:
  category: "customfield_14385"    # Type: Bug/Epic/Story
  dev_priority: "customfield_14425"  # Priority: Critical/High/Medium/Low
  theme: "customfield_14377"       # Strategic theme (not synced)
  roadmap: "customfield_14378"     # Timeline (not synced)
  
  # RICE scoring (stored in metadata, not labels)
  reach: "customfield_14379"
  impact: "customfield_14376"
  confidence: "customfield_14389"
  effort: "customfield_14387"
  value: "customfield_14386"

